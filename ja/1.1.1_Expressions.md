### <span class="chapnum">1.1.1</span> 式

プログラミングを始める簡単な方法のひとつとして、LispのScheme方言のインタプリタと対話をしてみて、その結果を調べるというやり方があります。コンピュータターミナルの前に座っているところを想像してみてください。あなたが**式**(_expression_)を入力すると、インタプリタはその式の**評価**(_evaluation_)の結果を表示することによって応答します。


タイプできる基本的な式のひとつとして、数値があります(より正確に言うと、あなたがタイプする式は、10進数の数値を表す数値からなります)。Lispに次の数値を入力すると、

```scheme
486
```

インタプリタは以下の内容を表示することで応答します。[^5]

```scheme
<i>486</i>
```

数値を表す式は、基本的な手続きを表す式(例えば$\texttt{+}$ や $\texttt{*}$)と組み合わせることで複合式を作り、数値に対し手続きを適用することを表します。例えば:

```scheme
(+ 137 349)
<i>486</i>
```

```scheme
(- 1000 334)
<i>666</i>
```

```scheme
(* 5 99)
<i>495</i>
```

```scheme
(/ 10 5)
<i>2</i>
```

```scheme
(+ 2.7 10)
<i>12.7</i>
```

このような式は、括弧の中の式のリストを区切ることにより作られ、手続きの適用を意味するもので、**組み合わせ**(_combination_)と呼ばれます。リストの左端の要素は**演算子**(_operator_)と呼ばれ、ほかの要素は**被演算子**(_operand_)と呼ばれます。組み合わせの値は、演算子によって指定された手続きを、被演算子の値である**引数**(_argument_)に適用することによって得られます。


演算子を被演算子の左に置くというやり方は、**前置記法**(_prefix notation_)として知られているものですが、数学で慣例となっているやり方とは大幅に違うので、最初は混乱するかもしれません。しかし、前置記法にはいくつかの利点があります。その中のひとつは、任意の数の引数を取る手続きにも対応できるということです。例を以下に示します。

```scheme
(+ 21 35 12 7)
<i>75</i>
```

```scheme
(* 25 4 12)
<i>1200</i>
```

演算子はいつでも左端の要素で、組み合わせ全体は括弧で区切られているので、曖昧さの入り込む余地はありません。


前置記法の二つ目の利点は、これを単純に拡張して、組み合わせを_ネスト_できる、つまり、組み合わせの要素がそれ自身組み合わせであるようなものが作れるということです。

```scheme
(+ (* 3 5) (- 10 6))
<i>19</i>
```

このようなネストや、Lispインタプリタが評価できる式の全体としての複雑性には(原則的には)制限がありません。次のような、まだ比較的単純な式に出会った場合、混乱してしまうのは私たち人間のほうです。

```scheme
(+ (* 3 (+ (* 2 4) (+ 3 5))) (+ (- 10 7) 6))
```

インタプリタは、迷うことなく57だと評価するでしょう。このような式は、次のような形で書くことで、私たち自身にわかりやすいようにできます。

```scheme
(+ (* 3
      (+ (* 2 4)
         (+ 3 5)))
   (+ (- 10 7)
      6))
```

**プリティプリント**(_pretty-printing_)として知られるフォーマットの慣習は、被演算子が垂直に揃うようにそれぞれの長い組み合わせを書くというものなのですが、上の式はそれに従って書いたものです。結果として、字下げが明確に式の構造を示すことになります。[^6]


複雑な式でも、インタプリタはいつでも同じ基本的なサイクルで動作します。式を端末から読み、式を評価し、結果を表示するというものです。この操作モードはよく、インタプリタの**REPL**(_read-eval-print loop_)モードと呼ばれます。特に、結果を表示することをインタプリタに明示的に指示しなくてもいいというところに注意してください。[^7]

---

[^5]: この本全体を通して、ユーザーの入力とインタプリタが表示した応答との違いを強調したい場合、後者を斜体で表します。

[^6]: Lispシステムは、普通はユーザーが式を整形しやすいようにする機構を持っています。その中でも特に役に立つものが二つあります。ひとつは、改行のタイミングで自動的に正しいプリティプリントの位置にインデントするというもので、もうひとつは右括弧が入力されるたびにマッチする左括弧をハイライトするというものです。

[^7]: Lispは、すべての式は値を持つという慣習に従っています。この慣習と、Lispは非効率的な言語であるという昔からの評判を組み合わせて、Alan PerlisはOscar Wildeのセリフをもじった次のような皮肉を言っています。“Lispプログラマはすべての値を知っているが、コストについては何も知らない”